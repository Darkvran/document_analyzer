# Тестовое задание

Реализовать веб-приложение. В качестве интерфейса сделать страницу с формой для загрузки текстового файла, после загрузки и обработки файла отображается таблица с 50 словами с колонками:
- слово
- tf, сколько раз это слово встречается в тексте
- idf, обратная частота документа
### Вывод упорядочить по уменьшению idf.
---
## Структура проекта
```
documentAnalyzer/
├── app/
│   ├── __init__.py #Инициализация flask-приложения
│   ├── routes/ 
│   │   ├── __init__.py #Сбор всех эндпоинтов воедино, включая как API, так и pages.
│   │   ├── index.py #pages эндпоинты
│   │   ├── auth.py #pages эндпоинты
│   │   ├── collections.py #pages эндпоинты
│   │   ├── api/ # Эндпоинты API
│   │   │   ├── __init__.py #Сбор всех эндпоинтов API.
│   │   │   ├── auth.py
│   │   │   ├── collections.py
│   │   │   ├── documents.py
│   │   │   ├── huffman.py
│   │   │   ├── user.py
│   │   │   └── utils.py
│   ├── templates # html-шаблоны
│   │   ├── collections.html
│   │   ├── index.html
│   │   ├── documents.html
│   │   ├── login.html
│   │   ├── register.html
│   │   ├── upload.html
│   ├── data.py # Содержит экземляр БД
│   ├── handling.py # Содержит логику обработки файлов
│   └── metric.py # Содержит логику сбора и сохранения метрик
├── run.py # Точка входа в приложение
├── Dockerfile
├── docker-compose.yml
├── nginx
└── requirements.txt
```
### .env
Содержит в себе все конфигурируемые параметры:
1. FLASK_SECRET_KEY
Секретный ключ Flask приложения
2. FLASK_PORT
Порт, по которому будет работать Flask приложение.
3. FLASK_HOST
IP-адрес, по которому будет работать Flask приложение.
4. FLASK_DEBUG
Флаг, отвечающий за debug-mode
5. MONGODB_URI
Адрес mongodb.
6. MONGODB_DB_NAME
Наименование mongodb.
7. APP_ALLOWED_EXTENSIONS
Множество допустимых расширений. Все иные расширения не могут быть загружены и обработаны.
---
## Схема базы данных
![Базы данных](https://github.com/Darkvran/documentAnalyzer/blob/main/data.png)
## Change-log
### 1.0.0
- Переход от Sqlite к MongoDB
- Добавление API:
  1. Добавление логики метрик. Создание класса MetricsCollector и эндпоинта /metrics
  2. Добавление проверки статуса приложения - эндпоинт /status.
  3. Добавление проверки текущей версии приложения - эндпоинт /version.
- files_processed - необходима для отслеживания количества файлов, обработанных приложением.
- min_time_processed, avg_time_processed, max_time_processed - отслеживание нагрузки на приложение, сколько уходит времени на обработку файлов.
- latest_file_processed_timestamp - отслеживание времени обработки последнего файла.
### 1.0.1
- Исправлена ошибка кодировки при чтении файлов с русскими символами.
- Установлено автоматическое определение кодировки файла, чтение в соответствии с ней.
### 1.1.0
- Авторизация пользователя.
- Регистрация пользователя.
- Пользовательская модель User в mongodb.
- Отдельные классы Document, зачаток класса Collection
- Приватная станица Upload (ее могут посещать лишь авторизованные пользователи).
### 1.2.0
- Коллекции:
  1. Возможность загружать файл в коллекцию
  2. Возможность удалять коллекции

### 1.3.0
- Добавлены новые эндпоинты API:
  1. Кодирование документа по Хаффману (GET /api/documents/<document_id>/huffman)
  2. Получение загруженных текущим пользователем документов (GET /api/documents/)
  3. Получение содержимого документа (GET /api/documents/<document_id>)
  4. Получение статистики по документу (GET /api/documents/<document_id>/statistics)
  5. Получение созданных текущим пользователем коллекций (GET /api/collections)
  6. Получение содержащихся в коллекции документов (GET /api/collections/<collection_id>)
  7. Получение статистки по коллекции (GET /api/collections/<collection_id>/statistics)
  8. Добавить документ в коллеццкию (POST /api/collections/<collection_id>/statistics)
  9. Удалить документ из коллекции (DELETE /api/collection/<collection_id>/<document_id>)
  10. Авторизация в приложение (POST /api/login)
  11. Регистрация в приложение (POST /api/register)
- Расширение страниц в приложении (возможность просматривать, создавать коллекции через web-интерфейс, загружать в них документы и т.д.)
- Логика обновления статистики документов в базе данных, когда загружаются/удаляются документы.

### 1.4.0
- Добавлены новые эндпоинты API:
  1. Изменение пароля текущего пользователя (PATCH /api/user/<user_id>)
  2. Удаление текущего пользователя со всеми его документами и коллекциями (DELETE /api/user/<user_id>)

### 2.0.0
- Полностью изменена архитектура приложения. "server.py" был удален, после того как был предварительно разобран:
  1. Код стал более читаем и найти нужные эндпоинты стало проще (Теперь нет необходимости искать их среди 1000 строк кода).
  2. Проект стал более удобным для потенциальных расширений.

### 2.1.0
- Добавлена поддержка swagger:
  1. Документация доступна по адресу /apidocs (пример: http://127.0.0.1:5000/apidocs/)
- Добавлены новые метрики:
  1. 5 последних продолжительности обработки файла
  2. Количество документов, загруженных за последние 24 часа

Данные метрики позволяют лучше отслеживать нагрузку на систему.

## Инструкция по установке
### Standart 
1. git clone https://github.com/Darkvran/document_analyzer
2. cd document_analyzer
3. python -m venv venv
4. venv\Scripts\activate.bat
5. pip install -r requirements.txt

Для запуска использовать:
python run.py
(!) Для запуска необходимо находиться в директории с run.py

### Docker-images
1. git clone https://github.com/Darkvran/document_analyzer
2. cd document_analyzer
3. docker compose up -d


# Итоги ревью
плюсы
- инструкция корректна. проект запустился сразу
- все эндпоинты работаю и возвращают результат
- авторизация и регистрация отлично реализованы
- крл отлично структурирован по модулям

минусы
- .env файл не должен быть доступен и залит в репозиторий, лучше .env.example (исправлено)
- версия приложения в swagger не совпадает с версией приложения полученному по эндпоинту /api/version
- при регистрации с апи нет проверки на валидность почты
- нет форматтора
- нет комментариев в коде
